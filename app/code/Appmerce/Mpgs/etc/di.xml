<?xml version="1.0"?>
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
    <preference for="Appmerce\Mpgs\Api\SessionInformationManagementInterface" type="Appmerce\Mpgs\Model\SessionInformationManagement" />

    <!-- Virtual operation classes that specify apiOperation generically -->
    <virtualType name="AuthorizeOperationDataBuilder" type="Appmerce\Mpgs\Gateway\Request\OperationBuilder">
        <arguments>
            <argument name="operation" xsi:type="string">AUTHORIZE</argument>
        </arguments>
    </virtualType>
    <virtualType name="CreateSessionOperationDataBuilder" type="Appmerce\Mpgs\Gateway\Request\OperationBuilder">
        <arguments>
            <argument name="operation" xsi:type="string">CREATE_CHECKOUT_SESSION</argument>
        </arguments>
    </virtualType>
    <virtualType name="CaptureOperationDataBuilder" type="Appmerce\Mpgs\Gateway\Request\OperationBuilder">
        <arguments>
            <argument name="operation" xsi:type="string">CAPTURE</argument>
        </arguments>
    </virtualType>
    <virtualType name="SaleOperationDataBuilder" type="Appmerce\Mpgs\Gateway\Request\OperationBuilder">
        <arguments>
            <argument name="operation" xsi:type="string">PAY</argument>
        </arguments>
    </virtualType>
    <virtualType name="RefundOperationDataBuilder" type="Appmerce\Mpgs\Gateway\Request\OperationBuilder">
        <arguments>
            <argument name="operation" xsi:type="string">REFUND</argument>
        </arguments>
    </virtualType>
    <virtualType name="VoidOperationDataBuilder" type="Appmerce\Mpgs\Gateway\Request\OperationBuilder">
        <arguments>
            <argument name="operation" xsi:type="string">VOID</argument>
        </arguments>
    </virtualType>
    <virtualType name="ThreeDSecureCheckOperationDataBuilder" type="Appmerce\Mpgs\Gateway\Request\OperationBuilder">
        <arguments>
            <argument name="operation" xsi:type="string">CHECK_3DS_ENROLLMENT</argument>
        </arguments>
    </virtualType>
    <virtualType name="ThreeDSecureProcessOperationDataBuilder" type="Appmerce\Mpgs\Gateway\Request\OperationBuilder">
        <arguments>
            <argument name="operation" xsi:type="string">PROCESS_ACS_RESULT</argument>
        </arguments>
    </virtualType>

    <type name="Appmerce\Mpgs\Gateway\Http\Client\Rest">
        <arguments>
            <argument name="logger" xsi:type="object">TnsLogger</argument>
            <argument name="converter" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Converter\JsonToArray</argument>
            <argument name="adapter" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Client\Adapter\Rest</argument>
        </arguments>
    </type>

    <!-- Check 3D-Secure enrollment -->
    <virtualType name="TnsThreeDSecureEnrollmentCommand" type="Appmerce\Mpgs\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsThreeDSecureDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">Appmerce\Mpgs\Gateway\Http\ThreeDSecure\TransferFactoryEnrolment</argument>
            <argument name="client" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Client\Rest</argument>
            <argument name="validator" xsi:type="object">Appmerce\Mpgs\Gateway\Validator\ThreeDSecureValidator</argument>
            <argument name="handler" xsi:type="object">Appmerce\Mpgs\Gateway\Response\ThreeDSecure\CheckHandler</argument>
        </arguments>
    </virtualType>
    <virtualType name="TnsHpfThreeDSecureEnrollmentCommand" type="Appmerce\Mpgs\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsThreeDSecureDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">MpgsHpfTransferFactoryEnrolment</argument>
            <argument name="client" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Client\Rest</argument>
            <argument name="validator" xsi:type="object">Appmerce\Mpgs\Gateway\Validator\ThreeDSecureValidator</argument>
            <argument name="handler" xsi:type="object">Appmerce\Mpgs\Gateway\Response\ThreeDSecure\CheckHandler</argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsHpfTransferFactoryEnrolment" type="Appmerce\Mpgs\Gateway\Http\ThreeDSecure\TransferFactoryEnrolment">
        <arguments>
            <argument name="config" xsi:type="object">TnsHpfConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsThreeDSecureDataBuilder" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="operation" xsi:type="string">ThreeDSecureCheckOperationDataBuilder</item>
                <item name="3ds_check" xsi:type="string">Appmerce\Mpgs\Gateway\Request\ThreeDSecure\CheckDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsVoidDataBuilder" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="operation" xsi:type="string">VoidOperationDataBuilder</item>
                <item name="void" xsi:type="string">Appmerce\Mpgs\Gateway\Request\VoidDataBuilder</item>
                <item name="version" xsi:type="string">Appmerce\Mpgs\Gateway\Request\VersionDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsRefundDataBuilder" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="operation" xsi:type="string">RefundOperationDataBuilder</item>
                <item name="refund" xsi:type="string">Appmerce\Mpgs\Gateway\Request\TransactionDataBuilder</item>
                <item name="version" xsi:type="string">Appmerce\Mpgs\Gateway\Request\VersionDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsCaptureDataBuilder" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="operation" xsi:type="string">CaptureOperationDataBuilder</item>
                <item name="capture" xsi:type="string">Appmerce\Mpgs\Gateway\Request\TransactionDataBuilder</item>
                <item name="version" xsi:type="string">Appmerce\Mpgs\Gateway\Request\VersionDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="Tns3DSecureVerifyDataBuilder" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="operation" xsi:type="string">ThreeDSecureProcessOperationDataBuilder</item>
                <item name="3ds_process" xsi:type="string">Appmerce\Mpgs\Gateway\Request\ThreeDSecure\ProcessDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsAuthorizeResponseHandler" type="Magento\Payment\Gateway\Response\HandlerChain">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="transaction" xsi:type="string">Appmerce\Mpgs\Gateway\Response\TransactionIdHandler</item>
                <item name="authorize" xsi:type="string">Appmerce\Mpgs\Gateway\Response\AuthorizeHandler</item>
                <item name="payment" xsi:type="string">Appmerce\Mpgs\Gateway\Response\PaymentHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <type name="Appmerce\Mpgs\Gateway\Command\UpdateOrderCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Appmerce\Mpgs\Gateway\Request\RequestParamsBuilder</argument>
            <argument name="transferFactory" xsi:type="object">Appmerce\Mpgs\Gateway\Http\GetTransferFactory</argument>
            <argument name="client" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Client\Rest</argument>
            <argument name="handler" xsi:type="object">Appmerce\Mpgs\Gateway\Response\UpdateOrderHandler</argument>
            <argument name="validator" xsi:type="object">Appmerce\Mpgs\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </type>
    <virtualType name="MpgsDirectUpdateOrderCommand" type="Appmerce\Mpgs\Gateway\Command\UpdateOrderCommand">
        <arguments>
            <argument name="transferFactory" xsi:type="object">MpgsDirectGetTransferFactory</argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsDirectGetTransferFactory" type="Appmerce\Mpgs\Gateway\Http\GetTransferFactory">
        <arguments>
            <argument name="config" xsi:type="object">TnsDirectConfig</argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsHpfUpdateOrderCommand" type="Appmerce\Mpgs\Gateway\Command\UpdateOrderCommand">
        <arguments>
            <argument name="transferFactory" xsi:type="object">MpgsHpfGetTransferFactory</argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsHpfGetTransferFactory" type="Appmerce\Mpgs\Gateway\Http\GetTransferFactory">
        <arguments>
            <argument name="config" xsi:type="object">TnsHpfConfig</argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsHostedUpdateOrderCommand" type="Appmerce\Mpgs\Gateway\Command\UpdateOrderCommand">
        <arguments>
            <argument name="transferFactory" xsi:type="object">MpgsHostedGetTransferFactory</argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsHostedGetTransferFactory" type="Appmerce\Mpgs\Gateway\Http\GetTransferFactory">
        <arguments>
            <argument name="config" xsi:type="object">TnsHostedConfig</argument>
        </arguments>
    </virtualType>
    <type name="Appmerce\Mpgs\Controller\Webhook\Response">
        <arguments>
            <argument name="commandPool" xsi:type="object">WebhookCommandPool</argument>
        </arguments>
    </type>
    <virtualType name="WebhookCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="tns_direct" xsi:type="string">MpgsDirectUpdateOrderCommand</item>
                <item name="tns_hpf" xsi:type="string">MpgsHpfUpdateOrderCommand</item>
                <item name="tns_hosted" xsi:type="string">MpgsHostedUpdateOrderCommand</item>
            </argument>
        </arguments>
    </virtualType>

    <type name="Magento\Payment\Gateway\Command\CommandManagerPool">
        <arguments>
            <argument name="executors" xsi:type="array">
                <item name="tns_direct" xsi:type="string">TnsDirectCommandManager</item>
                <item name="tns_hpf" xsi:type="string">TnsHpfCommandManager</item>
            </argument>
        </arguments>
    </type>

    <!-- ********** -->
    <!-- DIRECT API -->
    <!-- ********** -->
    <virtualType name="TnsDirectCommandManager" type="Magento\Payment\Gateway\Command\CommandManager">
        <arguments>
            <argument name="commandPool" xsi:type="object">TnsDirectCommandPool</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectInfoBlock" type="Appmerce\Mpgs\Block\Direct\Info">
        <arguments>
            <argument name="data" xsi:type="array">
                <item xsi:type="string" name="is_secure_mode">0</item>
            </argument>
            <argument name="config" xsi:type="object">TnsDirectConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectConfig" type="Appmerce\Mpgs\Gateway\Config\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Appmerce\Mpgs\Model\Ui\Direct\ConfigProvider::METHOD_CODE</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="3ds_process" xsi:type="string">TnsDirectThreeDSecureProcessCommand</item>
                <item name="authorize" xsi:type="string">AuthorizeStrategyCommand</item>
                <item name="authorize_simple" xsi:type="string">AuthorizeCommand</item>
                <item name="capture" xsi:type="string">CaptureStrategyCommand</item>
                <item name="capture_simple" xsi:type="string">TnsDirectSaleStrategyCommand</item>
                <item name="sale" xsi:type="string">TnsDirectSaleCommand</item>
                <item name="pre_auth_capture" xsi:type="string">TnsDirectPreAuthCaptureCommand</item>
                <item name="refund" xsi:type="string">TnsDirectRefundCommand</item>
                <item name="void" xsi:type="string">TnsDirectVoidCommand</item>
                <item name="create_token" xsi:type="string">MpgsDirectCreateTokenCommand</item>
                <item name="vault_sale" xsi:type="string">MpgsDirectVaultSaleCommand</item>
                <item name="vault_authorize" xsi:type="string">MpgsDirectVaultAuthorizeCommand</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- MPGS Direct Vault -->
    <virtualType name="MpgsDirectVaultFacade" type="Magento\Vault\Model\Method\Vault">
        <arguments>
            <argument name="config" xsi:type="object">MpgsDirectVaultPaymentConfig</argument>
            <argument name="valueHandlerPool" xsi:type="object">MpgsDirectVaultPaymentValueHandlerPool</argument>
            <argument name="vaultProvider" xsi:type="object">TnsDirectFacade</argument>
            <argument name="code" xsi:type="const">Appmerce\Mpgs\Model\Ui\Direct\ConfigProvider::CC_VAULT_CODE</argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsDirectVaultPaymentConfig" type="Magento\Payment\Gateway\Config\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Appmerce\Mpgs\Model\Ui\Direct\ConfigProvider::CC_VAULT_CODE</argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsDirectVaultPaymentValueHandlerPool" type="VaultPaymentValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">MpgsDirectVaultPaymentValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsDirectVaultPaymentValueHandler" type="VaultPaymentDefaultValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">MpgsDirectVaultPaymentConfig</argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsDirectCreateTokenCommand" type="Appmerce\Mpgs\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Appmerce\Mpgs\Gateway\Request\Direct\CardDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Vault\TransferFactoryCreateToken</argument>
            <argument name="client" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Client\Rest</argument>
            <argument name="handler" xsi:type="object">MpgsDirectTokenCreateHandler</argument>
            <argument name="validator" xsi:type="object">Appmerce\Mpgs\Gateway\Validator\TokenCreateValidator</argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsDirectTokenCreateHandler" type="Appmerce\Mpgs\Gateway\Response\TokenCreateHandler">
        <arguments>
            <argument name="config" xsi:type="object">TnsDirectConfig</argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsDirectVaultAuthorizeCommand" type="AuthorizeCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">MpgsDirectVaultAuthorizeDataBuilder</argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsDirectVaultAuthorizeDataBuilder" type="TnsDirectAuthorizeDataBuilder">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="card" xsi:type="string">Appmerce\Mpgs\Gateway\Request\TokenDataBuilder</item>
                <item name="version" xsi:type="string">Appmerce\Mpgs\Gateway\Request\VersionDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsDirectVaultSaleCommand" type="TnsDirectSaleCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">MpgsDirectVaultSaleDataBuilder</argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsDirectVaultSaleDataBuilder" type="TnsDirectSaleDataBuilder">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="card" xsi:type="string">Appmerce\Mpgs\Gateway\Request\TokenDataBuilder</item>
                <item name="version" xsi:type="string">Appmerce\Mpgs\Gateway\Request\VersionDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectFacade" type="Magento\Payment\Model\Method\Adapter">
        <arguments>
            <argument name="code" xsi:type="const">Appmerce\Mpgs\Model\Ui\Direct\ConfigProvider::METHOD_CODE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form\Cc</argument>
            <argument name="infoBlockType" xsi:type="string">TnsDirectInfoBlock</argument>
            <argument name="valueHandlerPool" xsi:type="object">TnsValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">TnsDirectValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">TnsDirectCommandPool</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">TnsDirectCountryValidator</item>
                <item name="currency" xsi:type="string">TnsDirectCurrencyValidator</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectCurrencyValidator" type="Appmerce\Mpgs\Gateway\Validator\CurrencyValidator">
        <arguments>
            <argument name="config" xsi:type="object">TnsDirectConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">TnsDirectConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">TnsDirectConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">TnsConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Pure authorize command -->
    <virtualType name="AuthorizeCommand" type="Appmerce\Mpgs\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsDirectAuthorizeDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">Appmerce\Mpgs\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Client\Rest</argument>
            <argument name="handler" xsi:type="object">TnsAuthorizeResponseHandler</argument>
            <argument name="validator" xsi:type="object">Appmerce\Mpgs\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Authorize -->
    <virtualType name="AuthorizeStrategyCommand" type="Appmerce\Mpgs\Gateway\Command\VerificationStrategyCommand">
        <arguments>
            <argument name="commandPool" xsi:type="object">TnsDirectCommandPool</argument>
            <argument name="config" xsi:type="object">TnsDirectConfig</argument>
            <argument name="successCommand" xsi:type="string">authorize_simple</argument>
        </arguments>
    </virtualType>

    <!-- Capture -->
    <virtualType name="CaptureStrategyCommand" type="Appmerce\Mpgs\Gateway\Command\VerificationStrategyCommand">
        <arguments>
            <argument name="commandPool" xsi:type="object">TnsDirectCommandPool</argument>
            <argument name="config" xsi:type="object">TnsDirectConfig</argument>
            <argument name="successCommand" xsi:type="string">capture_simple</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectSaleStrategyCommand" type="Appmerce\Mpgs\Gateway\Command\SaleStrategyCommand">
        <arguments>
            <argument name="commandPool" xsi:type="object">TnsDirectCommandPool</argument>
        </arguments>
    </virtualType>

    <!-- Authorize + Capture command aka. Sale -->
    <virtualType name="TnsDirectSaleCommand" type="Appmerce\Mpgs\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsDirectSaleDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">Appmerce\Mpgs\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Client\Rest</argument>
            <argument name="handler" xsi:type="object">TnsDirectSaleResponseHandler</argument>
            <argument name="validator" xsi:type="object">Appmerce\Mpgs\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Capture a pre-authorized payment (DIRECT) -->
    <virtualType name="TnsDirectPreAuthCaptureCommand" type="Appmerce\Mpgs\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsCaptureDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">Appmerce\Mpgs\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Client\Rest</argument>
            <argument name="handler" xsi:type="object">Appmerce\Mpgs\Gateway\Response\TransactionIdHandler</argument>
            <argument name="validator" xsi:type="object">Appmerce\Mpgs\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Void -->
    <virtualType name="TnsDirectVoidCommand" type="Appmerce\Mpgs\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsVoidDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">Appmerce\Mpgs\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Client\Rest</argument>
            <argument name="validator" xsi:type="object">Appmerce\Mpgs\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Refund -->
    <virtualType name="TnsDirectRefundCommand" type="Appmerce\Mpgs\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsRefundDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">Appmerce\Mpgs\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Client\Rest</argument>
            <argument name="validator" xsi:type="object">Appmerce\Mpgs\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Verify 3D-Secure results -->
    <virtualType name="TnsDirectThreeDSecureProcessCommand" type="Appmerce\Mpgs\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Tns3DSecureVerifyDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">Appmerce\Mpgs\Gateway\Http\ThreeDSecure\TransferFactoryProcess</argument>
            <argument name="client" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Client\Rest</argument>
            <argument name="validator" xsi:type="object">TnsDirectThreeDSecureResultValidator</argument>
            <argument name="handler" xsi:type="object">Appmerce\Mpgs\Gateway\Response\ThreeDSecure\ResultHandler</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectThreeDSecureResultValidator" type="Magento\Payment\Gateway\Validator\ValidatorComposite">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="response" xsi:type="string">Appmerce\Mpgs\Gateway\Validator\ThreeDSecureValidator</item>
                <item name="session" xsi:type="string">Appmerce\Mpgs\Gateway\Validator\ThreeDSecure\ProcessValidator</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectThreeDSecureResultDataBuilder" type="Appmerce\Mpgs\Gateway\Request\ThreeDSecure\ResultsDataBuilder">
        <arguments>
            <argument name="config" xsi:type="object">TnsDirectConfig</argument>
        </arguments>
    </virtualType>

    <type name="Appmerce\Mpgs\Gateway\Http\TransferFactory">
        <arguments>
            <argument name="config" xsi:type="object">TnsDirectConfig</argument>
        </arguments>
    </type>

    <virtualType name="TnsLogger" type="Magento\Payment\Model\Method\Logger">
        <arguments>
            <argument name="config" xsi:type="object">TnsDirectConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectAuthorizeDataBuilder" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="operation" xsi:type="string">AuthorizeOperationDataBuilder</item>
                <item name="card" xsi:type="string">Appmerce\Mpgs\Gateway\Request\Direct\CardDataBuilder</item>
                <item name="order" xsi:type="string">Appmerce\Mpgs\Gateway\Request\OrderDataBuilder</item>
                <item name="billing" xsi:type="string">Appmerce\Mpgs\Gateway\Request\BillingDataBuilder</item>
                <item name="shipping" xsi:type="string">Appmerce\Mpgs\Gateway\Request\ShippingDataBuilder</item>
                <item name="customer" xsi:type="string">Appmerce\Mpgs\Gateway\Request\CustomerDataBuilder</item>
                <item name="3ds_results" xsi:type="string">TnsDirectThreeDSecureResultDataBuilder</item>
                <item name="source" xsi:type="string">Appmerce\Mpgs\Gateway\Request\SourceDataBuilder</item>
                <item name="version" xsi:type="string">Appmerce\Mpgs\Gateway\Request\VersionDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectSaleDataBuilder" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="operation" xsi:type="string">SaleOperationDataBuilder</item>
                <item name="card" xsi:type="string">Appmerce\Mpgs\Gateway\Request\Direct\CardDataBuilder</item>
                <item name="order" xsi:type="string">Appmerce\Mpgs\Gateway\Request\OrderDataBuilder</item>
                <item name="billing" xsi:type="string">Appmerce\Mpgs\Gateway\Request\BillingDataBuilder</item>
                <item name="shipping" xsi:type="string">Appmerce\Mpgs\Gateway\Request\ShippingDataBuilder</item>
                <item name="customer" xsi:type="string">Appmerce\Mpgs\Gateway\Request\CustomerDataBuilder</item>
                <item name="3ds_results" xsi:type="string">TnsDirectThreeDSecureResultDataBuilder</item>
                <item name="source" xsi:type="string">Appmerce\Mpgs\Gateway\Request\SourceDataBuilder</item>
                <item name="version" xsi:type="string">Appmerce\Mpgs\Gateway\Request\VersionDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectSaleResponseHandler" type="Magento\Payment\Gateway\Response\HandlerChain">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="transaction" xsi:type="string">Appmerce\Mpgs\Gateway\Response\TransactionIdHandler</item>
                <item name="capture" xsi:type="string">Appmerce\Mpgs\Gateway\Response\CaptureHandler</item>
                <item name="payment" xsi:type="string">Appmerce\Mpgs\Gateway\Response\PaymentHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- *************** -->
    <!-- HOSTED CHECKOUT -->
    <!-- *************** -->
    <virtualType name="TnsHostedInfoBlock" type="Appmerce\Mpgs\Block\Direct\Info">
        <arguments>
            <argument name="data" xsi:type="array">
                <item xsi:type="string" name="is_secure_mode">0</item>
            </argument>
            <argument name="config" xsi:type="object">TnsHostedConfig</argument>
        </arguments>
    </virtualType>

    <type name="Appmerce\Mpgs\Model\SessionInformationManagement">
        <arguments>
            <argument name="commandPool" xsi:type="object">TnsHostedCommandPool</argument>
        </arguments>
    </type>

    <virtualType name="TnsHostedConfig" type="Appmerce\Mpgs\Gateway\Config\Hosted\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Appmerce\Mpgs\Model\Ui\Hosted\ConfigProvider::METHOD_CODE</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHostedCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="create_session" xsi:type="string">TnsHostedCreateSessionCommand</item>
                <item name="authorize" xsi:type="string">TnsHostedRetrieveOrderCommand</item>
                <item name="retrieve_order" xsi:type="string">TnsHostedRetrieveOrderCommand</item>
                <item name="capture" xsi:type="string">TnsHostedCaptureStrategyCommand</item>
                <item name="capture_simple" xsi:type="string">TnsHostedPreAuthCaptureCommand</item>
                <item name="refund" xsi:type="string">TnsHostedRefundCommand</item>
                <item name="void" xsi:type="string">TnsHostedVoidCommand</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="TnsHostedFacade" type="Magento\Payment\Model\Method\Adapter">
        <arguments>
            <argument name="code" xsi:type="const">Appmerce\Mpgs\Model\Ui\Hosted\ConfigProvider::METHOD_CODE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form\Cc</argument>
            <argument name="infoBlockType" xsi:type="string">TnsHostedInfoBlock</argument>
            <argument name="valueHandlerPool" xsi:type="object">TnsHostedValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">TnsHostedValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">TnsHostedCommandPool</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHostedValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">TnsHostedCountryValidator</item>
                <item name="currency" xsi:type="string">TnsHostedCurrencyValidator</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHostedCurrencyValidator" type="Appmerce\Mpgs\Gateway\Validator\CurrencyValidator">
        <arguments>
            <argument name="config" xsi:type="object">TnsHostedConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHostedCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">TnsHostedConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHostedConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">TnsHostedConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHostedValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">TnsHostedConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Capture -->
    <virtualType name="TnsHostedCaptureStrategyCommand" type="Appmerce\Mpgs\Gateway\Command\Hosted\CaptureStrategyCommand">
        <arguments>
            <argument name="commandPool" xsi:type="object">TnsHostedCommandPool</argument>
            <argument name="config" xsi:type="object">TnsHostedConfig</argument>
        </arguments>
    </virtualType>

    <!-- Create a HC session -->
    <virtualType name="TnsHostedCreateSessionCommand" type="Appmerce\Mpgs\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsHostedSessionDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Hosted\TransferFactorySession</argument>
            <argument name="client" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Client\Rest</argument>
            <argument name="handler" xsi:type="object">Appmerce\Mpgs\Gateway\Response\Hosted\SessionHandler</argument>
            <argument name="validator" xsi:type="object">Appmerce\Mpgs\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Verify HC payment -->
    <virtualType name="TnsHostedRetrieveOrderCommand" type="Appmerce\Mpgs\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Appmerce\Mpgs\Gateway\Request\Hosted\RetrieveOrderDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Hosted\TransferFactoryOrder</argument>
            <argument name="client" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Client\Rest</argument>
            <argument name="handler" xsi:type="object">Appmerce\Mpgs\Gateway\Response\Hosted\TransactionHandler</argument>
            <argument name="validator" xsi:type="object">TnsHostedOrderValidator</argument>
        </arguments>
    </virtualType>

    <!-- Capture a pre-authorized payment (HC) -->
    <virtualType name="TnsHostedPreAuthCaptureCommand" type="Appmerce\Mpgs\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsCaptureDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">HostedTransferFactory</argument>
            <argument name="client" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Client\Rest</argument>
            <argument name="handler" xsi:type="object">Appmerce\Mpgs\Gateway\Response\TransactionIdHandler</argument>
            <argument name="validator" xsi:type="object">Appmerce\Mpgs\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Refund (HC) -->
    <virtualType name="TnsHostedRefundCommand" type="Appmerce\Mpgs\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsRefundDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">HostedTransferFactory</argument>
            <argument name="client" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Client\Rest</argument>
            <argument name="validator" xsi:type="object">Appmerce\Mpgs\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Void (HC) -->
    <virtualType name="TnsHostedVoidCommand" type="Appmerce\Mpgs\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsVoidDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">HostedTransferFactory</argument>
            <argument name="client" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Client\Rest</argument>
            <argument name="validator" xsi:type="object">Appmerce\Mpgs\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHostedOrderValidator" type="Magento\Payment\Gateway\Validator\ValidatorComposite">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="response" xsi:type="string">Appmerce\Mpgs\Gateway\Validator\ResponseValidator</item>
                <item name="session" xsi:type="string">Appmerce\Mpgs\Gateway\Validator\Hosted\SessionIndicatorValidator</item>
            </argument>
        </arguments>
    </virtualType>

    <type name="Appmerce\Mpgs\Gateway\Http\Hosted\TransferFactorySession">
        <arguments>
            <argument name="config" xsi:type="object">TnsHostedConfig</argument>
        </arguments>
    </type>

    <virtualType name="HostedTransferFactory" type="Appmerce\Mpgs\Gateway\Http\TransferFactory">
        <arguments>
            <argument name="config" xsi:type="object">TnsHostedConfig</argument>
        </arguments>
    </virtualType>

    <type name="Appmerce\Mpgs\Gateway\Http\Hosted\TransferFactoryOrder">
        <arguments>
            <argument name="config" xsi:type="object">TnsHostedConfig</argument>
        </arguments>
    </type>

    <virtualType name="TnsHostedSessionDataBuilder" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="operation" xsi:type="string">CreateSessionOperationDataBuilder</item>
                <item name="order" xsi:type="string">Appmerce\Mpgs\Gateway\Request\Hosted\OrderDataBuilder</item>
                <item name="billing" xsi:type="string">Appmerce\Mpgs\Gateway\Request\BillingDataBuilder</item>
                <item name="shipping" xsi:type="string">Appmerce\Mpgs\Gateway\Request\ShippingDataBuilder</item>
                <item name="customer" xsi:type="string">Appmerce\Mpgs\Gateway\Request\CustomerDataBuilder</item>
                <item name="source" xsi:type="string">Appmerce\Mpgs\Gateway\Request\SourceDataBuilder</item>
                <item name="version" xsi:type="string">Appmerce\Mpgs\Gateway\Request\VersionDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- ******************* -->
    <!-- HOSTED PAYMENT FORM -->
    <!-- ******************* -->
    <virtualType name="TnsHpfCommandManager" type="Magento\Payment\Gateway\Command\CommandManager">
        <arguments>
            <argument name="commandPool" xsi:type="object">TnsHpfCommandPool</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHpfInfoBlock" type="Appmerce\Mpgs\Block\Direct\Info">
        <arguments>
            <argument name="data" xsi:type="array">
                <item xsi:type="string" name="is_secure_mode">0</item>
            </argument>
            <argument name="config" xsi:type="object">TnsHpfConfig</argument>
        </arguments>
    </virtualType>
    <virtualType name="TnsHpfConfig" type="Appmerce\Mpgs\Gateway\Config\Hpf\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Appmerce\Mpgs\Model\Ui\Hpf\ConfigProvider::METHOD_CODE</argument>
        </arguments>
    </virtualType>
    <virtualType name="TnsHpfValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">TnsHpfConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="TnsHpfConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">TnsHpfConfig</argument>
        </arguments>
    </virtualType>
    <virtualType name="TnsHpfFacade" type="Magento\Payment\Model\Method\Adapter">
        <arguments>
            <argument name="code" xsi:type="const">Appmerce\Mpgs\Model\Ui\Hpf\ConfigProvider::METHOD_CODE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form\Cc</argument>
            <argument name="infoBlockType" xsi:type="string">TnsHpfInfoBlock</argument>
            <argument name="valueHandlerPool" xsi:type="object">TnsHpfValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">TnsHpfValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">TnsHpfCommandPool</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHpfValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">TnsHpfCountryValidator</item>
                <item name="currency" xsi:type="string">TnsHpfCurrencyValidator</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHpfCurrencyValidator" type="Appmerce\Mpgs\Gateway\Validator\CurrencyValidator">
        <arguments>
            <argument name="config" xsi:type="object">TnsHpfConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHpfCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">TnsHpfConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHpfCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="authorize" xsi:type="string">TnsHpfAuthorizeStrategyCommand</item>
                <item name="authorize_simple" xsi:type="string">TnsHpfAuthorizeCommand</item>
                <item name="3ds_process" xsi:type="string">TnsHpf3dsProcessCommand</item>
                <item name="capture" xsi:type="string">TnsHpfCaptureStrategyCommand</item>
                <item name="capture_simple" xsi:type="string">TnsHpfSaleStrategyCommand</item>
                <item name="sale" xsi:type="string">TnsHpfSaleCommand</item>
                <item name="pre_auth_capture" xsi:type="string">TnsHpfPreAuthCaptureCommand</item>
                <item name="refund" xsi:type="string">TnsHpfRefundCommand</item>
                <item name="void" xsi:type="string">TnsHpfVoidCommand</item>
                <item name="create_token" xsi:type="string">MpgsHpfCreateTokenCommand</item>
                <item name="vault_sale" xsi:type="string">MpgsHpfVaultSaleCommand</item>
                <item name="vault_authorize" xsi:type="string">MpgsHpfVaultAuthorizeCommand</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- HPF Vault -->
    <virtualType name="MpgsHpfVaultFacade" type="Magento\Vault\Model\Method\Vault">
        <arguments>
            <argument name="config" xsi:type="object">MpgsHpfVaultPaymentConfig</argument>
            <argument name="valueHandlerPool" xsi:type="object">MpgsHpfVaultPaymentValueHandlerPool</argument>
            <argument name="vaultProvider" xsi:type="object">TnsHpfFacade</argument>
            <argument name="code" xsi:type="const">Appmerce\Mpgs\Model\Ui\Hpf\ConfigProvider::CC_VAULT_CODE</argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsHpfVaultPaymentConfig" type="Magento\Payment\Gateway\Config\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Appmerce\Mpgs\Model\Ui\Hpf\ConfigProvider::CC_VAULT_CODE</argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsHpfVaultPaymentValueHandlerPool" type="VaultPaymentValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">MpgsHpfVaultPaymentValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsHpfVaultPaymentValueHandler" type="VaultPaymentDefaultValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">MpgsHpfVaultPaymentConfig</argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsHpfCreateTokenCommand" type="Appmerce\Mpgs\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Appmerce\Mpgs\Gateway\Request\Hpf\SessionDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">MpgsHpfTrasferFactoryCreateToken</argument>
            <argument name="client" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Client\Rest</argument>
            <argument name="handler" xsi:type="object">MpgsHpfTokenCreateHandler</argument>
            <argument name="validator" xsi:type="object">Appmerce\Mpgs\Gateway\Validator\TokenCreateValidator</argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsHpfTrasferFactoryCreateToken" type="Appmerce\Mpgs\Gateway\Http\Vault\TransferFactoryCreateToken">
        <arguments>
            <argument name="config" xsi:type="object">TnsHpfConfig</argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsHpfTokenCreateHandler" type="Appmerce\Mpgs\Gateway\Response\TokenCreateHandler">
        <arguments>
            <argument name="config" xsi:type="object">TnsHpfConfig</argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsHpfVaultSaleCommand" type="TnsHpfSaleCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">MpgsHpfVaultSaleDataBuilder</argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsHpfVaultSaleDataBuilder" type="TnsHpfSaleDataBuilder">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="card" xsi:type="string">Appmerce\Mpgs\Gateway\Request\TokenDataBuilder</item>
                <item name="version" xsi:type="string">Appmerce\Mpgs\Gateway\Request\VersionDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsHpfVaultAuthorizeCommand" type="TnsHpfAuthorizeCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">MpgsHpfVaultAuthorizeDataBuilder</argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsHpfVaultAuthorizeDataBuilder" type="TnsHpfAuthorizeDataBuilder">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="card" xsi:type="string">Appmerce\Mpgs\Gateway\Request\TokenDataBuilder</item>
                <item name="version" xsi:type="string">Appmerce\Mpgs\Gateway\Request\VersionDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Void -->
    <virtualType name="TnsHpfVoidCommand" type="Appmerce\Mpgs\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsVoidDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">TnsHpfTransferFactory</argument>
            <argument name="client" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Client\Rest</argument>
            <argument name="validator" xsi:type="object">Appmerce\Mpgs\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Refund -->
    <virtualType name="TnsHpfRefundCommand" type="Appmerce\Mpgs\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsRefundDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">TnsHpfTransferFactory</argument>
            <argument name="client" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Client\Rest</argument>
            <argument name="validator" xsi:type="object">Appmerce\Mpgs\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Authorize + Capture command aka. Sale -->
    <virtualType name="TnsHpfSaleCommand" type="Appmerce\Mpgs\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsHpfSaleDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">TnsHpfTransferFactory</argument>
            <argument name="client" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Client\Rest</argument>
            <argument name="handler" xsi:type="object">TnsHpfSaleResponseHandler</argument>
            <argument name="validator" xsi:type="object">Appmerce\Mpgs\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>
    <virtualType name="TnsHpfSaleResponseHandler" type="Magento\Payment\Gateway\Response\HandlerChain">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="transaction" xsi:type="string">Appmerce\Mpgs\Gateway\Response\TransactionIdHandler</item>
                <item name="capture" xsi:type="string">Appmerce\Mpgs\Gateway\Response\CaptureHandler</item>
                <item name="payment" xsi:type="string">Appmerce\Mpgs\Gateway\Response\PaymentHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="TnsHpfSaleDataBuilder" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="operation" xsi:type="string">SaleOperationDataBuilder</item>
                <item name="card" xsi:type="string">Appmerce\Mpgs\Gateway\Request\Hpf\SessionDataBuilder</item>
                <item name="order" xsi:type="string">Appmerce\Mpgs\Gateway\Request\OrderDataBuilder</item>
                <item name="billing" xsi:type="string">Appmerce\Mpgs\Gateway\Request\BillingDataBuilder</item>
                <item name="shipping" xsi:type="string">Appmerce\Mpgs\Gateway\Request\ShippingDataBuilder</item>
                <item name="customer" xsi:type="string">Appmerce\Mpgs\Gateway\Request\CustomerDataBuilder</item>
                <item name="3ds_results" xsi:type="string">TnsHpfThreeDSecureResultDataBuilder</item>
                <item name="source" xsi:type="string">Appmerce\Mpgs\Gateway\Request\SourceDataBuilder</item>
                <item name="version" xsi:type="string">Appmerce\Mpgs\Gateway\Request\VersionDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Capture a pre-authorized payment (HPF) -->
    <virtualType name="TnsHpfPreAuthCaptureCommand" type="Appmerce\Mpgs\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsCaptureDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">TnsHpfTransferFactory</argument>
            <argument name="client" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Client\Rest</argument>
            <argument name="handler" xsi:type="object">Appmerce\Mpgs\Gateway\Response\TransactionIdHandler</argument>
            <argument name="validator" xsi:type="object">Appmerce\Mpgs\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Capture -->
    <virtualType name="TnsHpfCaptureStrategyCommand" type="Appmerce\Mpgs\Gateway\Command\VerificationStrategyCommand">
        <arguments>
            <argument name="commandPool" xsi:type="object">TnsHpfCommandPool</argument>
            <argument name="config" xsi:type="object">TnsHpfConfig</argument>
            <argument name="successCommand" xsi:type="string">capture_simple</argument>
        </arguments>
    </virtualType>
    <virtualType name="TnsHpfSaleStrategyCommand" type="Appmerce\Mpgs\Gateway\Command\SaleStrategyCommand">
        <arguments>
            <argument name="commandPool" xsi:type="object">TnsHpfCommandPool</argument>
        </arguments>
    </virtualType>

    <!-- Authorize -->
    <virtualType name="TnsHpfAuthorizeStrategyCommand" type="Appmerce\Mpgs\Gateway\Command\VerificationStrategyCommand">
        <arguments>
            <argument name="commandPool" xsi:type="object">TnsHpfCommandPool</argument>
            <argument name="config" xsi:type="object">TnsHpfConfig</argument>
            <argument name="successCommand" xsi:type="string">authorize_simple</argument>
        </arguments>
    </virtualType>

    <!-- Pure authorize command -->
    <virtualType name="TnsHpfAuthorizeCommand" type="Appmerce\Mpgs\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsHpfAuthorizeDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">TnsHpfTransferFactory</argument>
            <argument name="client" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Client\Rest</argument>
            <argument name="handler" xsi:type="object">TnsAuthorizeResponseHandler</argument>
            <argument name="validator" xsi:type="object">Appmerce\Mpgs\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Verify 3D-Secure results -->
    <virtualType name="TnsHpf3dsProcessCommand" type="Appmerce\Mpgs\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Tns3DSecureVerifyDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">MpgsHpfTransferFactoryProcess</argument>
            <argument name="client" xsi:type="object">Appmerce\Mpgs\Gateway\Http\Client\Rest</argument>
            <argument name="validator" xsi:type="object">TnsHpfThreeDSecureResultValidator</argument>
            <argument name="handler" xsi:type="object">Appmerce\Mpgs\Gateway\Response\ThreeDSecure\ResultHandler</argument>
        </arguments>
    </virtualType>
    <virtualType name="MpgsHpfTransferFactoryProcess" type="Appmerce\Mpgs\Gateway\Http\ThreeDSecure\TransferFactoryProcess">
        <arguments>
            <argument name="config" xsi:type="object">TnsHpfConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHpfThreeDSecureResultValidator" type="Magento\Payment\Gateway\Validator\ValidatorComposite">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="response" xsi:type="string">Appmerce\Mpgs\Gateway\Validator\ThreeDSecureValidator</item>
                <item name="session" xsi:type="string">Appmerce\Mpgs\Gateway\Validator\ThreeDSecure\ProcessValidator</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHpfAuthorizeDataBuilder" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="operation" xsi:type="string">AuthorizeOperationDataBuilder</item>
                <item name="session" xsi:type="string">Appmerce\Mpgs\Gateway\Request\Hpf\SessionDataBuilder</item>
                <item name="order" xsi:type="string">Appmerce\Mpgs\Gateway\Request\OrderDataBuilder</item>
                <item name="billing" xsi:type="string">Appmerce\Mpgs\Gateway\Request\BillingDataBuilder</item>
                <item name="shipping" xsi:type="string">Appmerce\Mpgs\Gateway\Request\ShippingDataBuilder</item>
                <item name="customer" xsi:type="string">Appmerce\Mpgs\Gateway\Request\CustomerDataBuilder</item>
                <item name="3ds_results" xsi:type="string">TnsHpfThreeDSecureResultDataBuilder</item>
                <item name="source" xsi:type="string">Appmerce\Mpgs\Gateway\Request\SourceDataBuilder</item>
                <item name="version" xsi:type="string">Appmerce\Mpgs\Gateway\Request\VersionDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHpfTransferFactory" type="Appmerce\Mpgs\Gateway\Http\TransferFactory">
        <arguments>
            <argument name="config" xsi:type="object">TnsHpfConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHpfThreeDSecureResultDataBuilder" type="Appmerce\Mpgs\Gateway\Request\ThreeDSecure\ResultsDataBuilder">
        <arguments>
            <argument name="config" xsi:type="object">TnsHpfConfig</argument>
        </arguments>
    </virtualType>
</config>
